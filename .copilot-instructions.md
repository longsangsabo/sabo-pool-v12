# COPILOT INSTRUCTIONS FOR SABO POOL
# ====================================

# ğŸ¯ OVERVIEW & PRIMARY DIRECTIVE
# **ALWAYS CHECK SHARED LOGIC PACKAGES FIRST BEFORE IMPLEMENTING ANY FEATURE**
# This file tells Copilot HOW to work with SABO Pool services effectively
# Copilot: Read this file to understand the project structure and workflow

## ğŸš¨ MANDATORY PRE-IMPLEMENTATION CHECKLIST:

### 1. **ğŸ“ SHARED LOGIC AUDIT (REQUIRED FIRST STEP)**
ALWAYS check these directories BEFORE implementing ANY feature:
```
/workspaces/sabo-pool-v12/packages/shared-business/src/
/workspaces/sabo-pool-v12/packages/shared-types/src/
/workspaces/sabo-pool-v12/packages/shared-hooks/src/
/workspaces/sabo-pool-v12/packages/shared-ui/src/
/workspaces/sabo-pool-v12/packages/shared-utils/src/
```

### 2. **ğŸ” SEARCH PROTOCOL (MANDATORY)**
- Use `list_dir` to explore shared packages structure
- Use `grep_search` to find existing implementations
- Use `semantic_search` for similar functionality
- Use `read_file` to understand existing business logic

### 3. **ğŸ“‹ DOCUMENTATION REQUIREMENT**
ALWAYS start responses with this format:
```
ğŸ” SHARED LOGIC AUDIT:
âœ… Found: [list existing shared components]
âŒ Missing: [list what needs creation]
ğŸ¯ Strategy: [REUSE/ENHANCE/WRAP/CREATE]
```

## ğŸ“ PROJECT STRUCTURE
```
/workspaces/sabo-pool-v12/
â”œâ”€â”€ packages/shared-business/src/          # ğŸ¯ SHARED BUSINESS LOGIC (CHECK FIRST!)
â”‚   â”œâ”€â”€ user/                              # User profile, settings, auth
â”‚   â”œâ”€â”€ ranking/                           # ELO, SPA, leaderboards
â”‚   â”œâ”€â”€ tournament/                        # Tournament management
â”‚   â”œâ”€â”€ club/                              # Club management
â”‚   â”œâ”€â”€ challenge/                         # Challenge system
â”‚   â”œâ”€â”€ payment/                           # Payment processing
â”‚   â”œâ”€â”€ notification/                      # Notification system
â”‚   â””â”€â”€ analytics/                         # Analytics tracking
â”œâ”€â”€ packages/shared-types/src/             # ğŸ¯ SHARED TYPES (CHECK FIRST!)
â”‚   â”œâ”€â”€ user.ts                            # User & profile types
â”‚   â”œâ”€â”€ elo.ts                             # Ranking types
â”‚   â”œâ”€â”€ game.ts                            # Game types
â”‚   â””â”€â”€ common.ts                          # Common types
â”œâ”€â”€ apps/sabo-user/src/services/           # Main services location
â”‚   â”œâ”€â”€ serviceDiscovery.ts                # ğŸ” READ THIS FIRST - Service discovery system
â”‚   â”œâ”€â”€ index.ts                           # Central exports
â”‚   â”œâ”€â”€ userService.ts                     # User management
â”‚   â”œâ”€â”€ tournamentService.ts               # Tournament management
â”‚   â””â”€â”€ ... (43 total services)
â”œâ”€â”€ apps/sabo_flutter/lib/services/        # Flutter service wrappers
â”œâ”€â”€ docs/SERVICES_DEVELOPMENT_GUIDE.md    # Development patterns
â”œâ”€â”€ SERVICES_REFERENCE.md                 # Complete service documentation
â””â”€â”€ SERVICES_IMPORTS.md                   # Copy-paste imports
```

## ğŸš€ COPILOT WORKFLOW (STEP-BY-STEP)

### STEP 1: Read Service Discovery
```
ALWAYS start by reading: /workspaces/sabo-pool-v12/apps/sabo-user/src/services/serviceDiscovery.ts
This file contains:
- Complete service registry
- Use case mappings
- File locations
- Dependencies
- Examples
```

### STEP 2: Find Relevant Services
```typescript
// Example: User wants to "create a tournament with payment"
import { findServicesFor, getServiceLocation } from './serviceDiscovery';

const services = findServicesFor('create tournament');
// Returns: ['tournamentService', 'userService', 'paymentService', 'notificationService']
```

### STEP 3: Read Service Files
```
For each service found:
1. Get file path: getServiceLocation('tournamentService')
2. Read the actual service file to understand API
3. Check dependencies: getServiceDependencies('tournamentService')
4. Look at examples: getServiceExamples('tournamentService')
```

### STEP 4: Implement Solution
```typescript
// Use the services with proper imports
import { tournamentService, paymentService, userService } from '@/services';

// Implement the feature
const tournament = await tournamentService.createTournament(data);
await paymentService.processPayment(paymentData);
```

## ğŸ” DISCOVERY FUNCTIONS (Use These!)

```typescript
// Find services for any use case
findServicesFor('user login') â†’ ['authService', 'userService', 'sessionService']
findServicesFor('send notification') â†’ ['notificationService', 'emailService', 'userService']
findServicesFor('upload file') â†’ ['storageService', 'userService', 'validationService']

// Get file location to read
getServiceLocation('userService') â†’ '/workspaces/sabo-pool-v12/apps/sabo-user/src/services/userService.ts'

// Search by keyword
searchServices('payment') â†’ ['paymentService', 'walletService', 'transactionService']

// Get service details
getServiceInfo('userService') â†’ { name, filePath, methods, dependencies, examples }
```

## ğŸ“š DOCUMENTATION PRIORITY

1. **serviceDiscovery.ts** - ğŸ”¥ READ FIRST - Service registry and discovery
2. **SERVICES_REFERENCE.md** - Complete service documentation
3. **docs/SERVICES_DEVELOPMENT_GUIDE.md** - Development patterns
4. **SERVICES_IMPORTS.md** - Import examples
5. **Individual service files** - Specific implementations

## ğŸ¯ COMMON USE CASES â†’ SERVICES

| User Request | Primary Services | Supporting Services |
|--------------|------------------|-------------------|
| "Create user account" | userService, authService | profileService, emailService |
| "Start tournament" | tournamentService | userService, paymentService, notificationService |
| "Process payment" | paymentService, walletService | transactionService, userService |
| "Send notification" | notificationService | emailService, userService |
| "Upload profile picture" | storageService | userService, validationService |
| "Real-time chat" | webSocketService | messageService, notificationService |
| "Offline support" | offlineService | syncService, cacheService |
| "Generate report" | reportingService | analyticsService, userService |
| "Manage club" | clubService | memberService, userService, roleService |
| "Verify rank" | verificationService | rankService, userService, storageService |

## ğŸ”§ SERVICE PATTERNS

### Standard Service Structure
```typescript
export class ServiceName {
  // Main CRUD operations
  async create(data: CreateData): Promise<Entity>
  async getById(id: string): Promise<Entity | null>
  async update(id: string, data: UpdateData): Promise<Entity>
  async delete(id: string): Promise<void>
  
  // Custom business methods
  async customMethod(params: Params): Promise<Result>
  
  // Private helpers
  private validate(data: any): void
  private transform(data: any): any
  private handleError(error: any): Error
}
```

### Import Patterns
```typescript
// Single service
import { userService } from '@/services/userService';

// Multiple services
import { userService, tournamentService, paymentService } from '@/services';

// Shared service
import { PaymentService } from '@sabo-pool/shared-business/payment/PaymentService';
```

## âš ï¸ IMPORTANT RULES

1. **ALWAYS check serviceDiscovery.ts first** - Don't guess which services exist
2. **Read actual service files** - Don't assume API based on names
3. **Check dependencies** - Understand service relationships
4. **Use examples** - Follow established patterns
5. **Handle errors** - All services have consistent error handling
6. **Validate inputs** - Services expect proper data validation

## ğŸš¨ ERROR PREVENTION

### Common Mistakes to Avoid:
- âŒ Using services without reading their actual implementation
- âŒ Assuming service methods without checking the file
- âŒ Ignoring service dependencies
- âŒ Not handling errors properly
- âŒ Calling non-existent methods

### Best Practices:
- âœ… Read serviceDiscovery.ts first
- âœ… Check actual service file before using
- âœ… Follow import patterns from SERVICES_IMPORTS.md
- âœ… Use proper error handling
- âœ… Validate inputs before service calls

## ğŸ”„ EXAMPLE COPILOT WORKFLOW

### User Request: "I want to create a tournament where users pay to join"

**Step 1: Discovery**
```typescript
import { findServicesFor, getServiceLocation } from './serviceDiscovery';

const services = findServicesFor('create tournament');
// Returns: ['tournamentService', 'userService', 'paymentService', 'notificationService']
```

**Step 2: Read Service Files**
```
Read files:
- /workspaces/sabo-pool-v12/apps/sabo-user/src/services/tournamentService.ts
- /workspaces/sabo-pool-v12/apps/sabo-user/src/services/paymentService.ts
- /workspaces/sabo-pool-v12/apps/sabo-user/src/services/userService.ts
- /workspaces/sabo-pool-v12/apps/sabo-user/src/services/notificationService.ts
```

**Step 3: Check Examples**
```typescript
const examples = getServiceExamples('tournamentService');
// See how to use tournamentService.createTournament()
```

**Step 4: Implement**
```typescript
import { tournamentService, paymentService, userService, notificationService } from '@/services';

export async function createPaidTournament(tournamentData: CreateTournamentData, creatorId: string) {
  try {
    // Verify user exists
    const user = await userService.getUserById(creatorId);
    if (!user) throw new Error('User not found');
    
    // Create tournament
    const tournament = await tournamentService.createTournament({
      ...tournamentData,
      creatorId,
      requiresPayment: true
    });
    
    // Send creation notification
    await notificationService.sendNotification({
      userId: creatorId,
      title: 'Tournament Created',
      message: `Your tournament "${tournament.name}" has been created successfully`
    });
    
    return tournament;
  } catch (error) {
    console.error('Failed to create paid tournament:', error);
    throw error;
  }
}
```

## ğŸ“Š SERVICE METRICS

- **Total Services**: 43
- **Categories**: 11
- **Implementation Status**: 100% (all services have implementations)
- **Documentation Coverage**: 100%
## ğŸ¯ IMPLEMENTATION PRIORITY LEVELS

### 1. **REUSE** (90% of cases) - Use existing shared logic
```typescript
// âœ… CORRECT: Import from shared packages
import { UserProfileService } from '@/packages/shared-business/src/user';
```

### 2. **ENHANCE** (8% of cases) - Extend existing shared logic
```typescript
// âœ… CORRECT: Extend existing service
export class EnhancedUserService extends UserProfileService {
  // Add new functionality while preserving existing
}
```

### 3. **WRAP** (1% of cases) - Create platform wrappers
```dart
// âœ… CORRECT: Flutter wrapper for shared logic
class UserProfileService {
  // Wraps packages/shared-business/src/user/user-profile.ts
}
```

### 4. **CREATE** (1% of cases) - Only if no shared logic exists
```typescript
// âš ï¸ LAST RESORT: Only when truly new functionality needed
// Must be added to shared packages for reuse
```

## ğŸš« FORBIDDEN PATTERNS

### âŒ NEVER DO THIS:
- Skip checking shared packages first
- Duplicate existing business logic
- Create platform-specific business logic
- Ignore existing type definitions
- Implement without shared logic audit

### âŒ WRONG EXAMPLE:
```typescript
// WRONG: Creating duplicate logic
const userService = {
  getProfile: (id) => { /* duplicate implementation */ }
};
```

## âœ… REQUIRED PATTERNS

### âœ… ALWAYS DO THIS:
- Check shared packages FIRST
- Use existing implementations
- Create thin wrapper layers only
- Follow established patterns
- Document integration approach

### âœ… CORRECT EXAMPLE:
```typescript
// CORRECT: Using shared logic
import { UserProfileService } from '@/packages/shared-business/src/user';

export const profileService = UserProfileService;
```

## ğŸ“‹ MANDATORY RESPONSE TEMPLATE

Every implementation response MUST start with:
```
ğŸ” SHARED LOGIC AUDIT:
âœ… Found: packages/shared-business/src/[module]/[file].ts
âœ… Found: packages/shared-types/src/[types].ts
ğŸ¯ Strategy: [REUSE/ENHANCE/WRAP/CREATE]

ğŸš€ IMPLEMENTATION PLAN:
1. [Specific steps using shared logic]
2. [Integration approach]
3. [Wrapper creation if needed]

ğŸ’¡ RESULT: Leveraging shared foundations for consistency
```

- **Test Coverage**: TBD (needs implementation)

## ğŸ”— QUICK LINKS

- **Shared Business Logic**: `/packages/shared-business/src/`
- **Shared Types**: `/packages/shared-types/src/`
- Service Discovery: `/apps/sabo-user/src/services/serviceDiscovery.ts`
- Central Exports: `/apps/sabo-user/src/services/index.ts`
- Documentation: `/docs/SERVICES_DEVELOPMENT_GUIDE.md`
- Reference: `/SERVICES_REFERENCE.md`
- Import Guide: `/SERVICES_IMPORTS.md`

---

**ğŸ¯ GOLDEN RULE**: "If it exists in shared packages, use it. If it doesn't exist but should be shared, enhance the shared packages. NEVER duplicate business logic!"
