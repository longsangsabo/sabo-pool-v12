# COPILOT INSTRUCTIONS FOR SABO POOL
# ====================================

# 🎯 OVERVIEW & PRIMARY DIRECTIVE
# **ALWAYS CHECK SHARED LOGIC PACKAGES FIRST BEFORE IMPLEMENTING ANY FEATURE**
# This file tells Copilot HOW to work with SABO Pool services effectively
# Copilot: Read this file to understand the project structure and workflow

## 🚨 MANDATORY PRE-IMPLEMENTATION CHECKLIST:

### 1. **📁 SHARED LOGIC AUDIT (REQUIRED FIRST STEP)**
ALWAYS check these directories BEFORE implementing ANY feature:
```
/workspaces/sabo-pool-v12/packages/shared-business/src/
/workspaces/sabo-pool-v12/packages/shared-types/src/
/workspaces/sabo-pool-v12/packages/shared-hooks/src/
/workspaces/sabo-pool-v12/packages/shared-ui/src/
/workspaces/sabo-pool-v12/packages/shared-utils/src/
```

### 2. **🔍 SEARCH PROTOCOL (MANDATORY)**
- Use `list_dir` to explore shared packages structure
- Use `grep_search` to find existing implementations
- Use `semantic_search` for similar functionality
- Use `read_file` to understand existing business logic

### 3. **📋 DOCUMENTATION REQUIREMENT**
ALWAYS start responses with this format:
```
🔍 SHARED LOGIC AUDIT:
✅ Found: [list existing shared components]
❌ Missing: [list what needs creation]
🎯 Strategy: [REUSE/ENHANCE/WRAP/CREATE]
```

## 📁 PROJECT STRUCTURE
```
/workspaces/sabo-pool-v12/
├── packages/shared-business/src/          # 🎯 SHARED BUSINESS LOGIC (CHECK FIRST!)
│   ├── user/                              # User profile, settings, auth
│   ├── ranking/                           # ELO, SPA, leaderboards
│   ├── tournament/                        # Tournament management
│   ├── club/                              # Club management
│   ├── challenge/                         # Challenge system
│   ├── payment/                           # Payment processing
│   ├── notification/                      # Notification system
│   └── analytics/                         # Analytics tracking
├── packages/shared-types/src/             # 🎯 SHARED TYPES (CHECK FIRST!)
│   ├── user.ts                            # User & profile types
│   ├── elo.ts                             # Ranking types
│   ├── game.ts                            # Game types
│   └── common.ts                          # Common types
├── apps/sabo-user/src/services/           # Main services location
│   ├── serviceDiscovery.ts                # 🔍 READ THIS FIRST - Service discovery system
│   ├── index.ts                           # Central exports
│   ├── userService.ts                     # User management
│   ├── tournamentService.ts               # Tournament management
│   └── ... (43 total services)
├── apps/sabo_flutter/lib/services/        # Flutter service wrappers
├── docs/SERVICES_DEVELOPMENT_GUIDE.md    # Development patterns
├── SERVICES_REFERENCE.md                 # Complete service documentation
└── SERVICES_IMPORTS.md                   # Copy-paste imports
```

## 🚀 COPILOT WORKFLOW (STEP-BY-STEP)

### STEP 1: Read Service Discovery
```
ALWAYS start by reading: /workspaces/sabo-pool-v12/apps/sabo-user/src/services/serviceDiscovery.ts
This file contains:
- Complete service registry
- Use case mappings
- File locations
- Dependencies
- Examples
```

### STEP 2: Find Relevant Services
```typescript
// Example: User wants to "create a tournament with payment"
import { findServicesFor, getServiceLocation } from './serviceDiscovery';

const services = findServicesFor('create tournament');
// Returns: ['tournamentService', 'userService', 'paymentService', 'notificationService']
```

### STEP 3: Read Service Files
```
For each service found:
1. Get file path: getServiceLocation('tournamentService')
2. Read the actual service file to understand API
3. Check dependencies: getServiceDependencies('tournamentService')
4. Look at examples: getServiceExamples('tournamentService')
```

### STEP 4: Implement Solution
```typescript
// Use the services with proper imports
import { tournamentService, paymentService, userService } from '@/services';

// Implement the feature
const tournament = await tournamentService.createTournament(data);
await paymentService.processPayment(paymentData);
```

## 🔍 DISCOVERY FUNCTIONS (Use These!)

```typescript
// Find services for any use case
findServicesFor('user login') → ['authService', 'userService', 'sessionService']
findServicesFor('send notification') → ['notificationService', 'emailService', 'userService']
findServicesFor('upload file') → ['storageService', 'userService', 'validationService']

// Get file location to read
getServiceLocation('userService') → '/workspaces/sabo-pool-v12/apps/sabo-user/src/services/userService.ts'

// Search by keyword
searchServices('payment') → ['paymentService', 'walletService', 'transactionService']

// Get service details
getServiceInfo('userService') → { name, filePath, methods, dependencies, examples }
```

## 📚 DOCUMENTATION PRIORITY

1. **serviceDiscovery.ts** - 🔥 READ FIRST - Service registry and discovery
2. **SERVICES_REFERENCE.md** - Complete service documentation
3. **docs/SERVICES_DEVELOPMENT_GUIDE.md** - Development patterns
4. **SERVICES_IMPORTS.md** - Import examples
5. **Individual service files** - Specific implementations

## 🎯 COMMON USE CASES → SERVICES

| User Request | Primary Services | Supporting Services |
|--------------|------------------|-------------------|
| "Create user account" | userService, authService | profileService, emailService |
| "Start tournament" | tournamentService | userService, paymentService, notificationService |
| "Process payment" | paymentService, walletService | transactionService, userService |
| "Send notification" | notificationService | emailService, userService |
| "Upload profile picture" | storageService | userService, validationService |
| "Real-time chat" | webSocketService | messageService, notificationService |
| "Offline support" | offlineService | syncService, cacheService |
| "Generate report" | reportingService | analyticsService, userService |
| "Manage club" | clubService | memberService, userService, roleService |
| "Verify rank" | verificationService | rankService, userService, storageService |

## 🔧 SERVICE PATTERNS

### Standard Service Structure
```typescript
export class ServiceName {
  // Main CRUD operations
  async create(data: CreateData): Promise<Entity>
  async getById(id: string): Promise<Entity | null>
  async update(id: string, data: UpdateData): Promise<Entity>
  async delete(id: string): Promise<void>
  
  // Custom business methods
  async customMethod(params: Params): Promise<Result>
  
  // Private helpers
  private validate(data: any): void
  private transform(data: any): any
  private handleError(error: any): Error
}
```

### Import Patterns
```typescript
// Single service
import { userService } from '@/services/userService';

// Multiple services
import { userService, tournamentService, paymentService } from '@/services';

// Shared service
import { PaymentService } from '@sabo-pool/shared-business/payment/PaymentService';
```

## ⚠️ IMPORTANT RULES

1. **ALWAYS check serviceDiscovery.ts first** - Don't guess which services exist
2. **Read actual service files** - Don't assume API based on names
3. **Check dependencies** - Understand service relationships
4. **Use examples** - Follow established patterns
5. **Handle errors** - All services have consistent error handling
6. **Validate inputs** - Services expect proper data validation

## 🚨 ERROR PREVENTION

### Common Mistakes to Avoid:
- ❌ Using services without reading their actual implementation
- ❌ Assuming service methods without checking the file
- ❌ Ignoring service dependencies
- ❌ Not handling errors properly
- ❌ Calling non-existent methods

### Best Practices:
- ✅ Read serviceDiscovery.ts first
- ✅ Check actual service file before using
- ✅ Follow import patterns from SERVICES_IMPORTS.md
- ✅ Use proper error handling
- ✅ Validate inputs before service calls

## 🔄 EXAMPLE COPILOT WORKFLOW

### User Request: "I want to create a tournament where users pay to join"

**Step 1: Discovery**
```typescript
import { findServicesFor, getServiceLocation } from './serviceDiscovery';

const services = findServicesFor('create tournament');
// Returns: ['tournamentService', 'userService', 'paymentService', 'notificationService']
```

**Step 2: Read Service Files**
```
Read files:
- /workspaces/sabo-pool-v12/apps/sabo-user/src/services/tournamentService.ts
- /workspaces/sabo-pool-v12/apps/sabo-user/src/services/paymentService.ts
- /workspaces/sabo-pool-v12/apps/sabo-user/src/services/userService.ts
- /workspaces/sabo-pool-v12/apps/sabo-user/src/services/notificationService.ts
```

**Step 3: Check Examples**
```typescript
const examples = getServiceExamples('tournamentService');
// See how to use tournamentService.createTournament()
```

**Step 4: Implement**
```typescript
import { tournamentService, paymentService, userService, notificationService } from '@/services';

export async function createPaidTournament(tournamentData: CreateTournamentData, creatorId: string) {
  try {
    // Verify user exists
    const user = await userService.getUserById(creatorId);
    if (!user) throw new Error('User not found');
    
    // Create tournament
    const tournament = await tournamentService.createTournament({
      ...tournamentData,
      creatorId,
      requiresPayment: true
    });
    
    // Send creation notification
    await notificationService.sendNotification({
      userId: creatorId,
      title: 'Tournament Created',
      message: `Your tournament "${tournament.name}" has been created successfully`
    });
    
    return tournament;
  } catch (error) {
    console.error('Failed to create paid tournament:', error);
    throw error;
  }
}
```

## 📊 SERVICE METRICS

- **Total Services**: 43
- **Categories**: 11
- **Implementation Status**: 100% (all services have implementations)
- **Documentation Coverage**: 100%
## 🎯 IMPLEMENTATION PRIORITY LEVELS

### 1. **REUSE** (90% of cases) - Use existing shared logic
```typescript
// ✅ CORRECT: Import from shared packages
import { UserProfileService } from '@/packages/shared-business/src/user';
```

### 2. **ENHANCE** (8% of cases) - Extend existing shared logic
```typescript
// ✅ CORRECT: Extend existing service
export class EnhancedUserService extends UserProfileService {
  // Add new functionality while preserving existing
}
```

### 3. **WRAP** (1% of cases) - Create platform wrappers
```dart
// ✅ CORRECT: Flutter wrapper for shared logic
class UserProfileService {
  // Wraps packages/shared-business/src/user/user-profile.ts
}
```

### 4. **CREATE** (1% of cases) - Only if no shared logic exists
```typescript
// ⚠️ LAST RESORT: Only when truly new functionality needed
// Must be added to shared packages for reuse
```

## 🚫 FORBIDDEN PATTERNS

### ❌ NEVER DO THIS:
- Skip checking shared packages first
- Duplicate existing business logic
- Create platform-specific business logic
- Ignore existing type definitions
- Implement without shared logic audit

### ❌ WRONG EXAMPLE:
```typescript
// WRONG: Creating duplicate logic
const userService = {
  getProfile: (id) => { /* duplicate implementation */ }
};
```

## ✅ REQUIRED PATTERNS

### ✅ ALWAYS DO THIS:
- Check shared packages FIRST
- Use existing implementations
- Create thin wrapper layers only
- Follow established patterns
- Document integration approach

### ✅ CORRECT EXAMPLE:
```typescript
// CORRECT: Using shared logic
import { UserProfileService } from '@/packages/shared-business/src/user';

export const profileService = UserProfileService;
```

## 📋 MANDATORY RESPONSE TEMPLATE

Every implementation response MUST start with:
```
🔍 SHARED LOGIC AUDIT:
✅ Found: packages/shared-business/src/[module]/[file].ts
✅ Found: packages/shared-types/src/[types].ts
🎯 Strategy: [REUSE/ENHANCE/WRAP/CREATE]

🚀 IMPLEMENTATION PLAN:
1. [Specific steps using shared logic]
2. [Integration approach]
3. [Wrapper creation if needed]

💡 RESULT: Leveraging shared foundations for consistency
```

- **Test Coverage**: TBD (needs implementation)

## 🔗 QUICK LINKS

- **Shared Business Logic**: `/packages/shared-business/src/`
- **Shared Types**: `/packages/shared-types/src/`
- Service Discovery: `/apps/sabo-user/src/services/serviceDiscovery.ts`
- Central Exports: `/apps/sabo-user/src/services/index.ts`
- Documentation: `/docs/SERVICES_DEVELOPMENT_GUIDE.md`
- Reference: `/SERVICES_REFERENCE.md`
- Import Guide: `/SERVICES_IMPORTS.md`

---

**🎯 GOLDEN RULE**: "If it exists in shared packages, use it. If it doesn't exist but should be shared, enhance the shared packages. NEVER duplicate business logic!"
